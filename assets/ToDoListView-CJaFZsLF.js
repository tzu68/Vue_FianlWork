import{u as B,r as n,f as D,c as i,a as e,t as f,w as m,v as N,b as d,n as y,F as O,g as S,d as p,o as u,h as V}from"./index-C9-gPgZb.js";import{a as v}from"./axios-DzWr6d29.js";const F={id:"todoListPage",class:"bg-half"},I=e("h1",null,[e("a",{href:"#"},"ONLINE TODO LIST")],-1),M={class:"todo_sm"},P={href:"javascript:;"},E={class:"conatiner todoListPage vhContainer"},U={class:"todoList_Content"},j={class:"inputBox"},R=e("i",{class:"fa fa-plus"},null,-1),q=[R],G={key:0,class:"todoList_list"},H={class:"todoList_tab"},J={class:"todoList_items"},K={class:"todoList_item"},Q={key:"{{item.id}}"},W={class:"todoList_label"},X=["checked","onClick"],Y=["onClick"],Z=e("i",{class:"fa fa-times"},null,-1),tt=[Z],et={class:"todoList_statistics"},st={key:0},ot={key:1},at={key:1,class:"text-align-center"},nt=e("p",null,"目前尚無代辦事項",-1),lt=[nt],dt={__name:"ToDoListView",setup(it){const $=B(),l=n(""),r=n("https://todolist-api.hexschool.io"),g=n(""),a=n(),c=n([]),h=n(""),L=n(!1),w=n({id:"",createTime:0,content:"",status:!1});async function C(){try{l.value=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");const o=`${r.value}/users/checkout`,t=await v.get(o,{headers:{Authorization:l.value}});console.log("檢查Token結果",t),t.status==200&&(g.value=t.data,L.value=!0,status.value="signIn")}catch(o){console.log("Token檢查失敗",o)}}async function _(){const o=`${r.value}/todos/`;try{const t=await v.get(o,{headers:{Authorization:l.value}});t.status==200&&(c.value=t.data.data)}catch(t){console.log("取得TodoList失敗",t)}}async function T(){if(h.value==""){alert("代辦事項不得空白");return}const o=`${r.value}/todos/`;try{const t=await v.post(o,{content:h.value},{headers:{Authorization:l.value}});h.value=""}catch(t){alert("新增代辦事項失敗",t),console.log("新增失敗",t)}await _()}async function x(o){const t=`${r.value}/todos/${o}`;try{const s=await v.delete(t,{headers:{Authorization:l.value}})}catch(s){console.log("刪除失敗",s)}w.value={},await _()}async function z(o){const t=`${r.value}/todos/${o}/toggle`;try{const s=await v.patch(t,{},{headers:{Authorization:l.value}})}catch(s){console.log("更新toggle失敗",s)}await _()}function k(o){a.value=o}async function b(){const o=`${r.value}/users/sign_out`;try{const t=await v.post(o,{},{headers:{Authorization:l.value}});$.push("/")}catch(t){alert(t)}}return D(async()=>{await C(),L.value?await _():$.push("/")}),(o,t)=>(u(),i("div",F,[e("nav",null,[I,e("ul",null,[e("li",M,[e("a",P,[e("span",null,f(g.value?`${g.value.nickname}的代辦`:"尚未登入"),1)])]),e("li",null,[e("a",{href:"#loginPage",onClick:t[0]||(t[0]=s=>b())},"登出")])])]),e("div",E,[e("div",U,[e("div",j,[m(e("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":t[1]||(t[1]=s=>h.value=s)},null,512),[[N,h.value]]),e("a",{href:"#",onClick:t[2]||(t[2]=d(s=>T(),["prevent"]))},q)]),c.value.length>0?(u(),i("div",G,[e("ul",H,[e("li",null,[e("a",{href:"#",onClick:t[3]||(t[3]=d(s=>k(),["prevent"])),class:y({active:a.value==null})},"全部",2)]),e("li",null,[e("a",{href:"#",onClick:t[4]||(t[4]=d(s=>k(!1),["prevent"])),class:y({active:a.value==!1})},"待完成",2)]),e("li",null,[e("a",{href:"#",onClick:t[5]||(t[5]=d(s=>k(!0),["prevent"])),class:y({active:a.value==!0})},"已完成",2)])]),e("div",J,[e("ul",K,[(u(!0),i(O,null,S(c.value,(s,ut)=>m((u(),i("li",Q,[e("label",W,[e("input",{class:"todoList_input",type:"checkbox",value:"true",checked:s.status,onClick:d(A=>z(s.id),["prevent"])},null,8,X),e("span",null,f(s.content),1)]),e("a",{href:"#",onClick:d(A=>x(s.id),["prevent"])},tt,8,Y)],512)),[[V,a.value==null?!0:a.value==s.status]])),128))]),e("div",et,[a.value==null||a.value==!0?(u(),i("p",st,f(c.value.filter(s=>s.status==!0).length)+" 個完成項目 ",1)):p("",!0),a.value==null||a.value==!1?(u(),i("p",ot,f(c.value.filter(s=>s.status==!1).length)+" 個未完成項目 ",1)):p("",!0)])])])):p("",!0),c.value.length==0?(u(),i("div",at,lt)):p("",!0)])])]))}};export{dt as default};
